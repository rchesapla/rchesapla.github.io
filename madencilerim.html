<!DOCTYPE html>
<html lang="tr" ng-app="miningApp">
<head>
<meta charset="UTF-8">
<title>Madencilerim</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>

<script src="js/app.js"></script>
<script src="js/services.js"></script>
<script src="js/user-miner-service.js"></script>
<script src="js/miner-service.js"></script>

<style>
body{
    background:#0f1630;
    color:white;
}
.panel{
    padding:40px;
}
</style>
</head>

<body ng-controller="MiningController">

<div class="container panel" ng-show="isLoadedUser">

    <div class="d-flex justify-content-between mb-4">
        <h3>MADENCİLERİM</h3>
        <button class="btn btn-danger" onclick="logout()">Çıkış</button>
    </div>

    <p>Toplam Miner: {{visible_user_miners.length}}</p>

    <div class="table-responsive mt-4">
        <table class="table table-dark table-bordered text-center">

            <thead>
                <tr>
                    <th>Miner</th>
                    <th>Güç</th>
                    <th>Bonus</th>
                    <th>Etki Gücü</th>
                </tr>
            </thead>

            <tbody>
                <tr ng-repeat="miner in visible_user_miners">

                    <td>
                        {{miner.name.en}}<br>
                        <img width="60"
                        src="https://static.rollercoin.com/static/img/market/miners/{{miner.filename}}.gif">
                    </td>

                    <td>
                        {{chooseBestHashRateUnit(miner.power,'GH/s').value.toFixed(2)}}
                        {{chooseBestHashRateUnit(miner.power,'GH/s').unit}}
                    </td>

                    <td>
                        {{(miner.bonus_power / 100)}}%
                    </td>

                    <td>
                        {{miner.removeImpactLegend.value.toFixed(2)}}
                        {{miner.removeImpactLegend.unit}}
                    </td>

                </tr>
            </tbody>

        </table>
    </div>

</div>

<script>

// URL parametresini al
function getQueryParam(param){
    let urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

// Çıkış
function logout(){
    localStorage.removeItem("rc_username");
    window.location.href = "index.html";
}

// Sayfa açıldığında
angular.element(document).ready(function () {

    let scope = angular.element(document.body).scope();

    let username = getQueryParam("user");

    if(!username){
        username = localStorage.getItem("rc_username");
    }

    if(!username){
        window.location.href = "index.html";
        return;
    }

    // Kullanıcıyı otomatik yükle
    scope.$applyAsync(function(){
        scope.onSelectPlayer({code: username});
    });

});
</script>

</body>
</html>
