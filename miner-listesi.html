<!DOCTYPE html>
<html lang="tr" ng-app="miningApp">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Miner Listesi - Otomatik Giriş</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
<script src="https://angular-ui.github.io/bootstrap/ui-bootstrap-tpls-2.5.0.js"></script>

<!-- Miner Data -->
<script src="https://wminerrc.github.io/calculator/data/basic_miners.js"></script>
<script src="https://wminerrc.github.io/calculator/data/merge_miners.js"></script>
<script src="https://wminerrc.github.io/calculator/data/old/merge_miners.js"></script>

<!-- Mevcut Sistem -->
<script src="js/app.js"></script>
<script src="js/miner-service.js"></script>
<script src="js/services.js"></script>

<style>
body{
    background:#0f1630;
    color:white;
}
.miner-card{
    background:#111a3a;
    border-radius:12px;
    padding:15px;
    text-align:center;
    margin-bottom:20px;
}
.miner-card img{
    width:80px;
}
</style>
</head>

<body ng-controller="MiningController">

<div class="container mt-4">

<h2 class="text-center mb-4">🚀 Miner Listesi</h2>

<!-- Kullanıcı Adı -->
<div class="row mb-4">
    <div class="col-md-6 mx-auto">
        <input type="text"
               class="form-control text-center"
               ng-model="userSearchText"
               placeholder="Kullanıcı adınızı yazın..."
               ng-change="autoLogin()">
    </div>
</div>

<!-- Yükleniyor -->
<div ng-if="loadingUser" class="alert alert-info text-center">
🔄 Kullanıcı yükleniyor...
</div>

<!-- Hata -->
<div ng-if="playerSearchNoResults" class="alert alert-danger text-center">
❌ Kullanıcı bulunamadı!
</div>

<!-- Miner Grid -->
<div class="row" ng-if="isLoadedUser">

    <div class="col-md-3"
         ng-repeat="miner in visible_user_miners
         | limitTo:itemsPerPage:(currentPage-1)*itemsPerPage">

        <div class="miner-card">

            <img src="https://static.rollercoin.com/static/img/market/miners/{{miner.filename}}.gif?v=1707996476608">

            <h6 class="mt-2">{{miner.name.en}}</h6>

            <p>
            ⚡ {{chooseBestHashRateUnit(miner.power, 'GH/s').value.toFixed(2)}}
            {{chooseBestHashRateUnit(miner.power, 'GH/s').unit}}
            </p>

            <p>🎁 {{(miner.bonus_power / 100)}}%</p>

        </div>
    </div>

</div>

<!-- Pagination -->
<div class="text-center mt-4" ng-if="isLoadedUser">
    <ul uib-pagination total-items="visible_user_miners.length"
        ng-model="currentPage"
        items-per-page="itemsPerPage"
        max-size="5"
        boundary-links="true">
    </ul>
</div>

</div>

<script>
angular.element(function () {
    const scope = angular.element(document.body).scope();

    scope.$apply(function () {

        scope.currentPage = 1;
        scope.itemsPerPage = 12;
        scope.loadingUser = false;

        let timeout;

        scope.autoLogin = function () {

            if (!scope.userSearchText || scope.userSearchText.length < 3) {
                return;
            }

            clearTimeout(timeout);

            timeout = setTimeout(function () {

                scope.loadingUser = true;
                scope.playerSearchNoResults = false;

                scope.getPlayerByName(scope.userSearchText).then(function(players){

                    if(players && players.length > 0){

                        scope.onSelectPlayer(players[0]);
                        scope.isLoadedUser = true;

                    } else {
                        scope.playerSearchNoResults = true;
                    }

                    scope.loadingUser = false;
                    scope.$apply();

                });

            }, 800); // 800ms bekleme (spam koruma)

        };

    });
});
</script>

</body>
</html>
