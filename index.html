<!DOCTYPE html>
<html lang="tr" ng-app="miningApp">
<head>
<meta charset="UTF-8">
<title>Rollercoin Giriş</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
<script src="https://angular-ui.github.io/bootstrap/ui-bootstrap-tpls-2.5.0.js"></script>

<script src="js/app.js"></script>
<script src="js/services.js"></script>
<script src="js/user-miner-service.js"></script>
<script src="js/miner-service.js"></script>

<style>
body{
    background:#0f1630;
    color:white;
}
.login-box{
    max-width:400px;
    margin:100px auto;
    padding:30px;
    background:#1b2130;
    border-radius:15px;
}
</style>
</head>

<body ng-controller="MiningController">

<div class="login-box text-center">

    <h4>Kullanıcı Adı</h4>

    <input type="text"
           ng-model="userSearchText"
           typeahead-wait-ms="300"
           uib-typeahead="player as player.code for player in getPlayerByName($viewValue)"
           typeahead-on-select="loginUser($item)"
           class="form-control mt-3"
           placeholder="Örn: FthCLK">

</div>

<script>
angular.element(document).ready(function () {

    let scope = angular.element(document.body).scope();

    // Daha önce giriş varsa direkt yönlendir
    let savedUser = localStorage.getItem("rc_username");
    if(savedUser){
        window.location.href = "madencilerim.html?user=" + savedUser;
    }

    scope.loginUser = function(player){

        scope.onSelectPlayer(player);

        // isLoadedUser true olana kadar bekle
        let checkInterval = setInterval(function(){

            if(scope.isLoadedUser === true){

                clearInterval(checkInterval);

                localStorage.setItem("rc_username", player.code);

                window.location.href =
                "madencilerim.html?user=" + player.code;
            }

        }, 200);

    };

});
</script>


</body>
</html>
